# Agent Skillsの段階的開示（Progressive Disclosure）

## 段階的開示とは

Agent Skillsの核心には、「Progressive Disclosure（段階的開示）」という設計思想があります。これは、情報を一度にすべて見せるのではなく、必要な情報だけを、必要なタイミングで段階的にAIに開示することで、コンテキストウィンドウを効率的に利用し、AIの「迷い」を最小限に抑える仕組みです。

従来のMCPツールでは、AIエージェントが起動時に利用可能なすべてのツールの定義を一度に読み込むため、ツール数が増えるとコンテキストウィンドウが圧迫され、性能が低下する問題がありました。段階的開示は、この問題を根本的に解決する革新的なアプローチです。

この仕組みは、人間が本を読む際の行動に似ています。まず目次を見て全体像を把握し、必要な章だけを読んで、さらに詳細が必要な場合は参考文献を参照するという、自然な情報取得の流れをAIに実装したものと言えます。

## 3段階の読み込み戦略

### レベル1：メタデータ（常に読み込まれる）

システム起動時に、スキルあたり約100トークンのコストで、スキルの名前（name）と説明（description）のYAMLフロントマターのみが読み込まれます。これは、図書館のカード目録のような役割を果たします。

この段階では、Claudeは各スキルが「何ができるか」と「いつ使うべきか」という基本的な情報だけを把握します。例えば、100個のスキルがインストールされていても、合計で約10,000トークン（100×100）しか消費せず、これは200,000トークンのコンテキストウィンドウのわずか5%に過ぎません。

```
---
name: PDF Processing
description: Extract text and tables from PDF files, fill forms, merge documents. Use when working with PDF files or when the user mentions PDFs, forms, or document extraction.
---
```

この段階では、Claudeは利用可能な全機能のマップを持つにとどまり、コンテキストを圧迫しません。これにより、AIは「どのスキルが利用可能か」を知りながらも、詳細な実装方法については知らない状態を維持できます。

### レベル2：指示（スキルがトリガーされたときに読み込まれる）

ユーザーのリクエストを分析し、特定のスキルが関連すると判断された時に、3,000〜5,000トークンのコストでSKILL.md本体の指示とガイダンスが読み込まれます。これは、図書館で特定の本を手に取って内容を確認する段階に相当します。

この段階では、Claudeは具体的な作業手順、使用するツール、注意事項などの詳細な指示を受け取ります。例えば、PDF処理スキルがトリガーされた場合、pdfplumberライブラリの使用方法、エラーハンドリングの方法、フォーム入力の手順などが含まれます。

````
# PDF Processing

## Quick start
Use pdfplumber to extract text from PDFs:

```python
import pdfplumber

with pdfplumber.open("document.pdf") as pdf:
    text = pdf.pages[0].extract_text()
```
For advanced form filling, see [FORMS.md](FORMS.md).
````

この段階で大半のタスクは実行可能になります。SKILL.mdには、基本的な使用方法から高度な機能まで、そのスキルで実行可能なすべての操作が網羅されています。

### レベル3：リソースとコード（必要に応じて読み込まれる）

SKILL.mdの内容だけでは不十分な場合、必要に応じて追加のマークダウンファイル、実行可能スクリプト、参照資料が読み込まれます。この段階では、実質的に無制限のトークンコスト（bash経由で実行されるため）で、より詳細な情報にアクセスできます。

これは、専門書の参考文献や付録を参照する段階に相当します。例えば、PDF処理スキルで複雑なフォーム入力が必要な場合、FORMS.mdファイルが読み込まれ、さらにAPIドキュメントやサンプルコードが参照されることもあります。

```
pdf-skill/
├── SKILL.md (main instructions)
├── FORMS.md (form-filling guide)
├── REFERENCE.md (detailed API reference)
└── scripts/
    └── fill_form.py (utility script)
```

## 段階的開示のメリット

段階的開示には3つの主要なメリットがあります。

### 1. コンテキスト効率化
任意の時点でコンテキストウィンドウに関連するコンテンツのみが占有され、不要な情報でコンテキストを圧迫しません。従来のMCPツールでは、50個のツールがインストールされていると、ツールの説明だけでコンテキストの30%以上を消費していましたが、段階的開示では、実際に使用されるスキルのみがコンテキストを消費します。

### 2. AIの判断負荷軽減
最初に読み込む情報が少ないため、AIの「迷い」が減り、タスクへの集中力が高まります。従来は「どのツールを使うべきか」という選択に時間を費やしていましたが、段階的開示では「どのスキルを使うべきか」という高レベルな判断に集中できます。

### 3. スケーラビリティ
数十から数百のスキルを同時に認識可能で、スキル数が増えても性能が低下しません。実際に、Anthropicのテスト環境では500個以上のスキルが同時に動作していることが確認されています。

## 実際の動作例

### PDF処理スキルの読み込みプロセス

PDF処理スキルの読み込みは以下の流れで行われます。

**ステップ1: 初期化**
システムプロンプトに「PDF Processing - Extract text and tables from PDF files, fill forms, merge documents」が含まれます。この時点では、Claudeは「PDF処理ができるスキルがある」ことだけを知っています。

**ステップ2: ユーザーリクエスト分析**
ユーザーが「このPDFからテキストを抽出して要約してください」とリクエストすると、Claudeはメタデータを参照し、「PDF Processing」スキルが関連すると判断します。

**ステップ3: スキル詳細読み込み**
Claudeはbash経由で`read pdf-skill/SKILL.md`を実行し、PDF処理の具体的な手順をコンテキストに読み込みます。この時点で、pdfplumberライブラリの使用方法や基本的なテキスト抽出手順が利用可能になります。

**ステップ4: タスク実行**
この例では、フォーム入力は必要ないため、FORMS.mdは読み込まれず、SKILL.mdからの指示を使用してタスクを完了します。必要に応じて、Pythonスクリプトを実行してPDFからテキストを抽出し、要約を生成します。

## アーキテクチャの特徴

Agent Skillsのアーキテクチャには3つの重要な特徴があります。

### ファイルシステムベース
Claudeは仮想マシン環境で動作し、ファイルシステムアクセスを備えたbashコマンドでスキルと対話します。これにより、オンデマンドでファイルアクセスが可能になり、必要な情報だけを動的に読み込むことができます。従来のAPIベースのアプローチとは異なり、ファイルシステムの柔軟性を活用して、より効率的な情報管理を実現しています。

### 効率的なスクリプト実行
スクリプトのコードはコンテキストウィンドウに読み込まれず、スクリプトの出力のみがトークンを消費します。これにより、決定論的な操作を提供しながら、コンテキストの無駄遣いを防ぐことができます。例えば、複雑なデータ処理スクリプトが1,000行のコードを持っていても、そのコードはコンテキストに含まれず、処理結果の「成功」や「エラー: ファイルが見つかりません」といった短いメッセージのみがトークンを消費します。

### バンドルコンテンツの制限なし
ファイルはアクセスされるまでコンテキストを消費しないため、包括的なAPIドキュメンテーション、大規模なデータセット、広範な例を含めることが可能です。使用されないバンドルコンテンツに対するコンテキストペナルティがありません。これにより、スキル開発者は「使うかもしれない」情報も含めて、より包括的なスキルを作成することができます。

## まとめ

段階的開示により、Agent Skillsは「ツールの多さ」と「性能の高さ」を両立させています。必要な情報だけを必要なタイミングで読み込むことで、コンテキストウィンドウを効率的に利用し、AIの判断負荷を軽減しながら、膨大な知識とツールを扱うことが可能になっています。

この革新的なアプローチは、AIエージェントの進化における重要なマイルストーンと言えるでしょう。従来の「すべてを一度に読み込む」方式から「必要な時だけ読み込む」方式への転換により、AIの実用性とスケーラビリティが大幅に向上しました。今後、より多くのスキルが開発され、AIエージェントがより高度で専門的なタスクを効率的に実行できるようになることが期待されます。
